(this["webpackJsonpmidi-musicxml-seq"]=this["webpackJsonpmidi-musicxml-seq"]||[]).push([[0],{124:function(e,t){},126:function(e,t){},138:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(19),i=a.n(r),s=(a(78),a(26)),l=a(14),o=(a(79),a(27)),u=a(140),m=a(141),d=a(142),p=a(143),f=function(){var e=Object(n.useRef)(null),t=Object(l.f)();return c.a.createElement(c.a.Fragment,null,c.a.createElement(o.Helmet,null,c.a.createElement("title",null,"MIDI\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"),c.a.createElement("body",null)),c.a.createElement(u.a,null,c.a.createElement(m.a,null,c.a.createElement(d.a,null,c.a.createElement("div",{className:"d-flex align-items-center justify-content-center",style:{height:"60vh"}},c.a.createElement("div",{className:"text-center"},c.a.createElement("div",{className:"mb-5"},c.a.createElement("h1",{className:"h3"},"MIDI\u304b\u3089\u6b4c\u8a5e\u3092\u5165\u529b\u3057\u3066MusicXML\u306b\u3059\u308b\u3084\u3064"),c.a.createElement("div",{className:"text-muted small"},"AI\u304d\u308a\u305f\u3093(NEUTRINO)\u306b\u6b4c\u8a5e\u5165\u529b\u3092\u3057\u3084\u3059\u304f\u3059\u308b\u76ee\u7684\u3067",c.a.createElement("span",{className:"font-weight-bold"},"\u958b\u767a\u5b9f\u9a13\u4e2d"))),c.a.createElement(p.a,{type:"button",color:"primary",size:"lg",className:"font-weight-bold",onClick:function(){e.current.click()}},"MIDI\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u6b4c\u8a5e\u5165\u529b\u3059\u308b"),c.a.createElement("input",{ref:e,type:"file",id:"midi-file-input",className:"d-none",accept:"audio/midi, audio/x-midi",onChange:function(e){var a=e.target.files[0],n=new FileReader;n.readAsArrayBuffer(a),n.onload=function(e){t.push("/edit",{midiData:e.target.result})},n.onerror=function(e){window.alert("\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}}}))),c.a.createElement("div",{className:"text-center mb-4"}),c.a.createElement("div",{className:"text-muted text-center small"},c.a.createElement("div",null,"\u6982\u8981\u3068\u6ce8\u610f\u70b9\u3092\u8aad\u3093\u3067\u81ea\u5df1\u8cac\u4efb\u3067\u3054\u5229\u7528\u304f\u3060\u3055\u3044"),c.a.createElement("div",null,"\u3054\u9023\u7d61\u306f ",c.a.createElement("a",{href:"https://twitter.com/romotco",target:"_blank",rel:"noopener noreferrer"},"Twitter @romotco")," \u307e\u3067"))))))},E=a(72),h=a(15),y=a(10),v=a(145),b=a(144),g=function(e){var t=e.keys,a=e.octave,n={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"};return c.a.createElement("div",{className:"sequence-keys"},t.map((function(e,t){return c.a.createElement(c.a.Fragment,{key:t},c.a.createElement("div",{className:"sequence-key sequence-key-".concat(e.midi," sequence-key-").concat(e.color," sequence-key-").concat(e.pitch),id:"sequence-key-".concat(e.midi)},c.a.createElement("span",{className:"sequence-key-base"},n[e.pitch],a+1)))})))},x=a(22),k=a.n(x),O=a(146),j=function(e){var t=e.note,a=e.xScale,r=e.yScale,i=e.transpose,s=e.phoneme,l=e.lyric,o=e.index,u=e.edit,m=e.setEdit,d=e.onChange,p=Object(n.useRef)(null),f=Object(n.useState)(""),E=Object(y.a)(f,2),h=E[0],v=E[1],b={left:"".concat(t.ticks*a,"px"),bottom:"".concat((t.midi-12)*r+i*r,"px"),width:"".concat(t.durationTicks*a,"px")};Object(n.useEffect)((function(){v(s)}),[s]),Object(n.useEffect)((function(){u===o&&p.current.select()}),[u]);var g=u===o;return c.a.createElement("div",{className:"note",onClick:function(e){e.stopPropagation(),u||(m(o),p&&p.current.select())},style:b},c.a.createElement("input",{type:"text",value:h||"",onKeyPress:function(e){var t=e.key.toLowerCase();("enter"===t||"tab"===t&&l.length<o)&&m(o+1)},onChange:function(e){v(e.target.value),e.target.value&&(1===e.target.value.length?d(e.target.value[0],o):k()(e.target.value)&&d(e.target.value,o))},className:"note-input",maxLength:"3",ref:p,id:"note-".concat(o)}),!g&&c.a.createElement(O.a,{target:"note-".concat(o),placement:"bottom",delay:{show:200}},h," ",c.a.createElement("span",{className:"text-muted"},t.name)))},N=function(e){var t=e.midi,a=e.trackIndex,r=void 0===a?0:a,i=e.transpose,s=void 0===i?0:i,l=e.lyric,o=e.setLyric,u=e.xScale,m=e.yScale,d=Object(h.a)(Array(128).keys()).reduce((function(e,t,a){return a%12===0?[].concat(Object(h.a)(e),[[t]]):[].concat(Object(h.a)(e.slice(0,-1)),[[].concat(Object(h.a)(e[e.length-1]),[t])])}),[]).map((function(e,t){return e.map((function(e,a){return{midi:e,pitch:a,octave:9-t,color:[0,2,4,5,7,9,11].indexOf(a)>-1?"white":"black"}})).reverse()})).reverse(),p=t&&t.toJSON(),f=p.header,E=p&&f.timeSignatures&&f.timeSignatures.length>0?f.timeSignatures[0].timeSignature:[4,4],v=p&&p.tracks[r].notes,b=v?v.slice(-1)[0].ticks+v.slice(-1)[0].durationTicks:7680,x=(p?f.ppq:480)*E[1]*(E[0]/E[1]),k=Math.ceil(b/x),O=x*k,N=function(e,t){var a=l.map((function(a,n){return n===t?e:a}));o(a)},w=Object(n.useState)(!1),_=Object(y.a)(w,2),S=_[0],q=_[1];return c.a.createElement("div",{className:"sequence"},c.a.createElement("div",{className:"sequence-scales"},d.map((function(e,t,a){return c.a.createElement(g,{keys:e,octave:9-t,key:t})}))),c.a.createElement("div",{className:"sequence-body"},c.a.createElement("div",{className:"sequence-grid-y",style:{width:"".concat(O*u,"px")},onClick:function(){return q(!1)}},d.map((function(e,t,a){return c.a.createElement("div",{className:"sequence-grid-octave",key:t},e.map((function(e,t){return c.a.createElement("div",{key:t,className:"sequence-grid-pitch sequence-grid-pitch-".concat(e.color)})})))}))),c.a.createElement("div",{className:"sequence-grid-x"},Object(h.a)(Array(k).keys()).map((function(e,t){return c.a.createElement("div",{className:"sequence-grid-measure",key:t,style:{left:"".concat(x*u*(t+1),"px")}})}))),t&&p.tracks[r].notes.map((function(e,t){return c.a.createElement(j,{note:e,xScale:u,yScale:m,transpose:s,key:t,phoneme:l[t],edit:S,setEdit:q,index:t,lyric:l,onChange:N})}))))},w=function(e){var t=e.lyric,a=e.setLyric,r=e.expand,i=e.setExpand,s=e.limit,l=Object(n.useState)(""),o=Object(y.a)(l,2),u=o[0],m=o[1],d=function(e){var t=e.replace(/\s/g,"").trim(),n=[];t.split("").forEach((function(e,t,a){var c=a[t+1]||!1;k()(e)||(c&&k()(c)?n.push(e+c):n.push(e))})),a(n.slice(0,s))};return Object(n.useEffect)((function(){m(t.join(""))}),[t]),c.a.createElement(b.a,{type:"textarea",className:"lyric-text mr-3 ".concat(r?"lyric-text-expand":""),value:u,onClick:function(){return i(!0)},onChange:function(e){m(e.target.value)},onBlur:function(e){d(e.target.value)},onCompositionEnd:function(e){d(e.target.value)}})},_=a(69),S=a(71),q=a(70),C=a.n(q),I=function(e){var t=Object(l.f)(),a=Object(l.g)(),r=Object(n.useState)(!1),i=Object(y.a)(r,2),s=i[0],f=i[1],g=Object(n.useState)(0),x=Object(y.a)(g,2),k=x[0],O=x[1],j=Object(n.useState)(120),q=Object(y.a)(j,2),I=q[0],M=q[1],L=Object(n.useState)(0),T=Object(y.a)(L,2),A=T[0],D=T[1],B=Object(n.useState)(!1),R=Object(y.a)(B,2),F=R[0],P=R[1],J=Object(n.useState)(24),U=Object(y.a)(J,2),G=U[0],H=U[1],W=Object(n.useState)(.25),X=Object(y.a)(W,2),z=X[0],K=X[1],V=Object(n.useState)([]),$=Object(y.a)(V,2),Q=$[0],Y=$[1];Object(n.useEffect)((function(){var e=a.state&&a.state.midiData;if(e)if(e.tracks<1)window.alert("\u30c8\u30e9\u30c3\u30af\u304c\u3042\u308a\u307e\u305b\u3093"),t.push("/");else{var n=new _.Midi(e),c=n.header.tempos.length?n.header.tempos.slice(-1)[0].bpm:120;f(n),O(0),M(c),Y(n.tracks[k].notes.map((function(){return"\u3089"}))),H(24)}}),[a.state]),Object(n.useEffect)((function(){document.querySelector("#sequence-key-70").scrollIntoView()}),[]);return c.a.createElement(c.a.Fragment,null,c.a.createElement(o.Helmet,null,c.a.createElement("title",null,"MIDI\u7de8\u96c6"),c.a.createElement("body",null)),c.a.createElement(v.a,{color:"light",light:!0,className:"fixed-top"},c.a.createElement("div",{className:"d-flex align-items-center mr-auto"},c.a.createElement(p.a,{className:"rounded-circle mr-3 btn-icon",color:"light",onClick:function(){window.confirm("\u30c7\u30fc\u30bf\u306f\u4fdd\u5b58\u3055\u308c\u307e\u305b\u3093")&&(f(!1),t.push("/"))}},c.a.createElement(S.a,null)),c.a.createElement("span",{className:"mr-2"},"BPM"),c.a.createElement(b.a,{type:"number",color:"light",placeholder:"\u30c6\u30f3\u30dd",value:I,onChange:function(e){M(e.target.value)},style:{width:"70px"},className:"mr-3"}),c.a.createElement("span",{className:"mr-2"},"\u30ad\u30fc"),c.a.createElement(b.a,{type:"number",min:"-24",max:"24",value:A,style:{width:"70px"},onChange:function(e){D(e.target.value)}})),c.a.createElement(p.a,{color:"primary",onClick:function(){var e=function(e){var t=3===e.length,a=t?e.slice(0,-2):e.slice(0,-1),n=e.slice(-1),c=t?parseInt(A)+1:parseInt(A);return{step:{_text:a},alter:{_text:c>0?"+".concat(c.toString()):c.toString()},octave:{_text:n}}},t=s.toJSON(),a=t.header,n=Array.isArray(a.timeSignatures)&&a.timeSignatures.length>0?a.timeSignatures[0].timeSignature:[4,4],c=t.tracks[k],r=c.notes.slice(-1)[0].durationTicks+c.notes.slice(-1)[0].ticks,i=a.ppq*n[1]*(n[0]/n[1]),l=Math.ceil(r/i),o=Object(h.a)(Array(l).keys()).map((function(t,a){var n=a*i,r=n+i,s=c.notes.map((function(e,t){return r>e.ticks&&(n<=e.ticks||n<e.ticks+e.durationTicks)?Object(E.a)({},e,{lyric:Q[t]||""}):null})).filter((function(e){return null!==e})),l=[];return 0===s.length?l.push({rest:{},duration:{_text:i}}):s.forEach((function(t,a,c){var i=c[a-1]||!1,s=c[a+1]||!1,o=t.ticks+t.durationTicks,u=!!i&&i.ticks+i.durationTicks;!i&&t.ticks>n?l.push({rest:{},duration:{_text:t.ticks-n}}):!i&&t.ticks<n?l.push({_attributes:{dynamics:100*t.velocity},pitch:e(t.name),duration:{_text:o-n},tie:{_attributes:{type:"stop"}}}):i&&u<t.ticks&&l.push({rest:{},duration:{_text:t.ticks-u}}),o>r?l.push({_attributes:{dynamics:100*t.velocity},pitch:e(t.name),duration:{_text:r-t.ticks},lyric:{text:{_text:t.lyric}},tie:{_attributes:{type:"start"}}}):t.ticks>=n&&l.push({_attributes:{dynamics:100*t.velocity},pitch:e(t.name),duration:{_text:t.durationTicks},lyric:{text:{_text:t.lyric}}}),!s&&r>o&&l.push({rest:{},duration:{_text:r-o}})})),{_attributes:{number:a+2},note:l}}));o.unshift({_attributes:{number:"1"},attributes:{divisions:{_text:a.ppq},key:{fifths:{_text:"0"}},time:{beats:{_text:n[0]},"beat-type":{_text:n[1]}},clef:{sign:{_text:"G"},line:{_text:"2"}}},direction:{_attributes:{placement:"above"},sound:{_attributes:{tempo:I}}},note:{rest:{},duration:{_text:i}}});var u={_declaration:{_attributes:{version:"1.0",encoding:"utf-8"}},_doctype:'score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd"',"score-partwise":{_attributes:{version:"3.1"},"part-list":{"score-part":{_attributes:{id:"p".concat(k)},"part-name":{_text:a.name||""}}},part:{_attributes:{id:"p".concat(k)},measure:o}}},m=C.a.json2xml(u,{compact:!0,spaces:2}),d=new Blob([m],{type:"text/plain;charset=utf-8"}),p=document.createElement("a");p.download="score.musicxml",p.href=URL.createObjectURL(d),p.click()}},"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9")),c.a.createElement(u.a,{fluid:!0,className:"px-0",style:{marginTop:"56px"}},c.a.createElement(m.a,{className:"no-gutters",onClick:function(){return P(!1)}},c.a.createElement(d.a,null,c.a.createElement(N,{midi:s,trackIndex:k,transpose:A,lyric:Q,setLyric:Y,xScale:z,yScale:G}))),c.a.createElement(m.a,null,c.a.createElement("div",{className:"sequence-controls"},c.a.createElement("div",{className:"d-flex align-items-start p-3"},c.a.createElement(w,{lyric:Q,setLyric:Y,expand:F,setExpand:P,limit:s?s.tracks[k].notes.length:0}),c.a.createElement(b.a,{type:"range",className:"sequence-scale-range",max:"0.5",min:"0.025",step:"0.025",value:z,onChange:function(e){K(e.target.value)}}))))))},M=function(){return c.a.createElement(s.a,null,c.a.createElement(l.c,null,c.a.createElement(l.a,{exact:!0,path:"/",component:f}),c.a.createElement(l.a,{exact:!0,path:"/edit",component:I})))};var L=function(){return c.a.createElement("div",{className:"app"},c.a.createElement("main",{className:"main"},c.a.createElement(M,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(c.a.createElement(L,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},73:function(e,t,a){e.exports=a(138)},78:function(e,t,a){},79:function(e,t,a){}},[[73,1,2]]]);
//# sourceMappingURL=main.3434c5dd.chunk.js.map