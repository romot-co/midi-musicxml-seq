(this["webpackJsonpmidi-musicxml-seq"]=this["webpackJsonpmidi-musicxml-seq"]||[]).push([[0],{123:function(e,t){},125:function(e,t){},137:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),l=a(18),r=a.n(l),i=(a(77),a(25)),o=a(14),s=(a(78),a(26)),m=a(139),u=a(140),d=a(141),p=a(142),f=function(){var e=Object(n.useRef)(null),t=Object(o.f)();return c.a.createElement(c.a.Fragment,null,c.a.createElement(s.Helmet,null,c.a.createElement("title",null,"MIDI\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"),c.a.createElement("body",null)),c.a.createElement(m.a,null,c.a.createElement(u.a,null,c.a.createElement(d.a,null,c.a.createElement("div",{className:"vh-100 d-flex align-items-center justify-content-center"},c.a.createElement("div",{className:"text-center"},c.a.createElement("h1",{className:"mb-3"},"MMXSEQ"),c.a.createElement(p.a,{type:"button",color:"primary",onClick:function(){e.current.click()}},"MIDI\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"),c.a.createElement("input",{ref:e,type:"file",id:"midi-file-input",className:"d-none",accept:"audio/midi, audio/x-midi",onChange:function(e){var a=e.target.files[0],n=new FileReader;n.readAsArrayBuffer(a),n.onload=function(e){t.push("/edit",{midiData:e.target.result})},n.onerror=function(e){window.alert("\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}}})))))))},E=a(27),y=a(13),v=a(143),h=a(144),b=a(22),g=a(145),x=function(e){var t=e.note,a=e.xScale,l=e.phoneme,r=e.lyric,i=e.index,o=e.edit,s=e.setEdit,m=e.onChange,u=Object(n.useRef)(null),d=Object(n.useState)(""),p=Object(y.a)(d,2),f=p[0],E=p[1],v={left:"".concat(t.ticks*a,"px"),bottom:"".concat(24*(t.midi-12),"px"),width:"".concat(t.durationTicks*a,"px")};Object(n.useEffect)((function(){E(l)}),[l]),Object(n.useEffect)((function(){o===i&&u.current.select()}),[o]);var h=o===i;return c.a.createElement("div",{className:"note",onClick:function(e){e.stopPropagation(),o||(s(i),u&&u.current.select())},style:v},c.a.createElement("input",{type:"text",value:f||"",onKeyPress:function(e){var t=e.key.toLowerCase();("enter"===t||"tab"===t&&r.length<i)&&s(i+1)},onChange:function(e){E(e.target.value[0]),e.target.value&&m(e.target.value[0],i)},className:"note-input",maxLength:"1",ref:u,id:"note-".concat(i)}),!h&&c.a.createElement(g.a,{target:"note-".concat(i),placement:"bottom",delay:{show:200}},f," ",c.a.createElement("span",{className:"text-muted"},t.name)))},k=function(e){var t=e.keys,a=e.octave,n={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"};return c.a.createElement("div",{className:"sequence-scale"},t.map((function(e,t){return c.a.createElement(c.a.Fragment,{key:t},c.a.createElement("div",{className:"sequence-key sequence-key-".concat(e.midi," sequence-key-").concat(e.color," sequence-key-").concat(e.pitch),id:"sequence-key-".concat(e.midi)},c.a.createElement("span",{className:"sequence-key-base"},n[e.pitch],a+1)))})))},j=function(e){var t=e.midi,a=e.trackIndex,l=void 0===a?0:a,r=e.lyric,i=e.setLyric,o=e.xScale,s=Object(b.a)(Array(128).keys()).reduce((function(e,t,a){return a%12===0?[].concat(Object(b.a)(e),[[t]]):[].concat(Object(b.a)(e.slice(0,-1)),[[].concat(Object(b.a)(e[e.length-1]),[t])])}),[]).map((function(e,t){return e.map((function(e,a){return{midi:e,pitch:a,octave:9-t,color:[0,2,4,5,7,9,11].indexOf(a)>-1?"white":"black"}})).reverse()})).reverse(),m=t&&t.toJSON(),u=m&&m.tracks[l].notes,d=u?(u[u.length-1].ticks+u[u.length-1].durationTicks)*o:1e3,p=function(e,t){var a=r.split("").map((function(a,n){return n===t?e:a})).join("");i(a)},f=Object(n.useState)(!1),E=Object(y.a)(f,2),v=E[0],h=E[1];return c.a.createElement("div",{className:"sequence"},c.a.createElement("div",{className:"sequence-scales"},s.map((function(e,t,a){return c.a.createElement(k,{keys:e,octave:9-t,key:t})}))),c.a.createElement("div",{className:"sequence-body"},c.a.createElement("div",{className:"sequence-grid",style:{width:"".concat(d/o,"px")},onClick:function(){return h(!1)}},s.map((function(e,t,a){return c.a.createElement("div",{className:"sequence-grid-octave",key:t},e.map((function(e,t){return c.a.createElement("div",{key:t,className:"sequence-grid-pitch sequence-grid-pitch-".concat(e.color)})})))}))),t&&m.tracks[l].notes.map((function(e,t){return c.a.createElement(x,{note:e,xScale:o,key:t,phoneme:r[t],edit:v,setEdit:h,index:t,lyric:r,onChange:p})}))))},O=a(69),N=a(71),w=a(70),q=a.n(w),C=function(e){var t,a=Object(o.f)(),l=Object(o.g)(),r=Object(n.useState)(!1),i=Object(y.a)(r,2),f=i[0],b=i[1],g=Object(n.useState)(120),x=Object(y.a)(g,2),k=x[0],w=x[1],C=Object(n.useState)(0),S=Object(y.a)(C,2),I=S[0],M=(S[1],Object(n.useState)(.25)),D=Object(y.a)(M,2),L=D[0],B=D[1],F=Object(n.useState)(""),A=Object(y.a)(F,2),R=A[0],J=A[1];Object(n.useEffect)((function(){var e=l.state&&l.state.midiData;if(e)if(e.tracks<1)window.alert("\u30c8\u30e9\u30c3\u30af\u304c\u3042\u308a\u307e\u305b\u3093"),a.push("/");else{var t=new O.Midi(e);b(t),w(t.header.tempos[0]||120),J(t.tracks[0].notes.map((function(){return"\u3042"})).join(""))}}),[l.state]),Object(n.useEffect)((function(){document.querySelector("#sequence-key-60").scrollIntoView()}),[]);return c.a.createElement(c.a.Fragment,null,c.a.createElement(s.Helmet,null,c.a.createElement("title",null,"MIDI\u7de8\u96c6"),c.a.createElement("body",null)),c.a.createElement(v.a,{color:"light",light:!0,className:"fixed-top"},c.a.createElement("div",{className:"d-flex align-items-center mr-auto"},c.a.createElement(p.a,{className:"rounded-circle mr-3 btn-icon",color:"light",onClick:function(){window.confirm("\u30c7\u30fc\u30bf\u306f\u4fdd\u5b58\u3055\u308c\u307e\u305b\u3093")&&(b(!1),a.push("/"))}},c.a.createElement(N.a,null)),c.a.createElement(h.a,{type:"number",color:"light",placeholder:"\u30c6\u30f3\u30dd",value:k,onChange:function(e){w(e.target.value)},style:{width:"80px"},className:"mr-2"}),"BPM"),c.a.createElement(p.a,{color:"primary",onClick:function(){var e={declaration:{attributes:{version:"1.0",encoding:"utf-8"}},elements:[{type:"element",name:"score-partwise",attributes:{version:"3.1"},elements:[{type:"element",name:"part",elements:[{type:"element",name:"measure",elements:f.tracks[I].notes.map((function(e,t){return{type:"element",name:"note",elements:[{type:"element",name:"pitch",elements:[{type:"element",name:"step",elements:[{type:"text",text:e.name.slice(0,-1)}]},{type:"element",name:"octave",elements:[{type:"text",text:e.name.slice(-1)}]}]},{type:"element",name:"duration",elements:[{type:"text",text:e.duration}]},{type:"element",name:"lyric",elements:[{type:"element",name:"text",elements:[{type:"text",text:R[t]}]}]}]}}))}]}]}]},t=q.a.json2xml(e),a=new Blob([t],{type:"text/plain;charset=utf-8"}),n=document.createElement("a");n.download="score.musicxml",n.href=URL.createObjectURL(a),n.click()}},"MusicXML\u751f\u6210")),c.a.createElement(m.a,{fluid:!0,className:"px-0",style:{marginTop:"56px"}},c.a.createElement(u.a,{className:"no-gutters"},c.a.createElement(d.a,null,c.a.createElement(j,{midi:f,trackIndex:I,lyric:R,xScale:L,setLyric:J}))),c.a.createElement(u.a,null,c.a.createElement("div",{className:"sequence-controls"},c.a.createElement("div",{className:"d-flex align-items-start p-3"},c.a.createElement(h.a,(t={className:"lyric-text",type:"textarea"},Object(E.a)(t,"className","mr-3"),Object(E.a)(t,"value",R),Object(E.a)(t,"onChange",(function(e){var t=e.target.value.split("").map((function(e){return e.trim()})).join("");J(t)})),t)),c.a.createElement(h.a,{type:"range",className:"sequence-scale-range",max:"0.5",min:"0.05",step:"0.05",value:L,onChange:function(e){B(e.target.value)}}))))))},S=function(){return c.a.createElement(i.a,null,c.a.createElement(o.c,null,c.a.createElement(o.a,{exact:!0,path:"/",component:f}),c.a.createElement(o.a,{exact:!0,path:"/edit",component:C})))};var I=function(){return c.a.createElement("div",{className:"app"},c.a.createElement("main",{className:"main"},c.a.createElement(S,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(c.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},72:function(e,t,a){e.exports=a(137)},77:function(e,t,a){},78:function(e,t,a){}},[[72,1,2]]]);
//# sourceMappingURL=main.d2e6ce5d.chunk.js.map