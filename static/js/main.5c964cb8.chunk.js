(this["webpackJsonpmidi-musicxml-seq"]=this["webpackJsonpmidi-musicxml-seq"]||[]).push([[0],{141:function(e,t){},143:function(e,t){},155:function(e,t,a){var n={"./en/main":[160,3],"./ja/main":[161,4]};function c(e){if(!a.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],c=t[0];return a.e(t[1]).then((function(){return a.t(c,7)}))}c.keys=function(){return Object.keys(n)},c.id=155,e.exports=c},158:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),r=a(20),l=a.n(r),i=(a(96),a(97),a(89)),o=a(22),s=a(59),u=a(23),m=a(11),d=a(83),p=a(169),b=a(86),f=a(58),h=a(163),E=a(179),y=a(180),j=a(170),g=a(171),v=a(172),O=a(166),k=a(167),x=a(173),N=a(174),w=a(175),_=a(176),S=a(177),C=a(162),q=function(e){var t=e.keys,a=e.octave,n={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"};return c.a.createElement("div",{className:"sequence-keys"},t.map((function(e,t){return c.a.createElement(c.a.Fragment,{key:t},c.a.createElement("div",{className:"sequence-key sequence-key-".concat(e.midi," sequence-key-").concat(e.color," sequence-key-").concat(e.pitch),id:"sequence-key-".concat(e.midi)},c.a.createElement("span",{className:"sequence-key-base"},n[e.pitch],a+1)),c.a.createElement(C.a,{target:"sequence-key-".concat(e.midi),placement:"right"},n[e.pitch],a))})))},M=a(26),L=a.n(M),T=a(17),I=function(e){var t=e.note,a=e.xScale,r=e.yScale,l=e.transpose,i=e.phoneme,o=e.lyric,s=e.index,u=e.edit,d=e.setEdit,p=e.locale,b=e.onChange,f=Object(n.useRef)(null),h=Object(n.useState)(""),E=Object(m.a)(h,2),y=E[0],j=E[1],g={left:"".concat(t.ticks*a,"px"),bottom:"".concat((t.midi-12)*r+l*r,"px"),width:"".concat(t.durationTicks*a,"px")};Object(n.useEffect)((function(){j(i)}),[i]),Object(n.useEffect)((function(){u===s&&f.current.select()}),[u]);var v=u===s;return c.a.createElement("div",{className:"note",onClick:function(e){e.stopPropagation(),u||(d(s),f&&f.current.select())},style:g},c.a.createElement("input",{type:"text",value:y||"",onKeyPress:function(e){var t=e.key.toLowerCase();("enter"===t||"tab"===t&&o.length<s)&&d(s+1)},onChange:function(e){j(e.target.value),"ja"===p&&(e.target.value?1===e.target.value.length?b(e.target.value[0],s):L()(e.target.value)&&b(e.target.value,s):b(" ",s)),"en"===p&&(e.target.value?1===e.target.value.length?b(e.target.value[0],s):Object(T.isRomaji)(e.target.value)&&b(e.target.value,s):b(" ",s))},className:"note-input",maxLength:"ja"===p?2:3,ref:f,id:"note-".concat(s)}),!v&&c.a.createElement(C.a,{target:"note-".concat(s),placement:"bottom",delay:{show:200}},y," ",c.a.createElement("span",{className:"text-muted"},t.name)))},R=function(e){var t=e.midi,a=e.trackIndex,r=void 0===a?0:a,l=e.transpose,i=void 0===l?0:l,o=e.lyric,s=e.setLyric,d=e.xScale,p=e.yScale,b=e.locale,f=Object(u.a)(Array(128).keys()).reduce((function(e,t,a){return a%12===0?[].concat(Object(u.a)(e),[[t]]):[].concat(Object(u.a)(e.slice(0,-1)),[[].concat(Object(u.a)(e[e.length-1]),[t])])}),[]).map((function(e,t){return e.map((function(e,a){return{midi:e,pitch:a,octave:9-t,color:[0,2,4,5,7,9,11].indexOf(a)>-1?"white":"black"}})).reverse()})).reverse(),h=t&&t.toJSON(),E=h.header,y=h&&E.timeSignatures&&E.timeSignatures.length>0?E.timeSignatures[0].timeSignature:[4,4],j=h&&h.tracks[r].notes,g=j?j.slice(-1)[0].ticks+j.slice(-1)[0].durationTicks:7680,v=(h?E.ppq:480)*y[1]*(y[0]/y[1]),O=Math.ceil(g/v),k=v*O,x=function(e,t){var a=o.map((function(a,n){return n===t?e:a}));s(a)},N=Object(n.useState)(!1),w=Object(m.a)(N,2),_=w[0],S=w[1];return c.a.createElement("div",{className:"sequence"},c.a.createElement("div",{className:"sequence-scales"},f.map((function(e,t,a){return c.a.createElement(q,{keys:e,octave:9-t,key:t})}))),c.a.createElement("div",{className:"sequence-body"},c.a.createElement("div",{className:"sequence-grid-y",style:{width:"".concat(k*d,"px")},onClick:function(){return S(!1)}},f.map((function(e,t,a){return c.a.createElement("div",{className:"sequence-grid-octave",key:t},e.map((function(e,t){return c.a.createElement("div",{key:t,className:"sequence-grid-pitch sequence-grid-pitch-".concat(e.color)})})))}))),c.a.createElement("div",{className:"sequence-grid-x"},Object(u.a)(Array(O).keys()).map((function(e,t){return c.a.createElement("div",{className:"sequence-grid-measure",key:t,style:{left:"".concat(v*d*(t+1),"px")}})}))),t&&h.tracks[r].notes.map((function(e,t){return c.a.createElement(I,{note:e,xScale:d,yScale:p,transpose:i,key:t,phoneme:o[t],edit:_,setEdit:S,index:t,lyric:o,locale:b,onChange:x})}))))},A=a(56),B=a.n(A),F=a(8),D=function(e){var t=e.lyric,a=e.setLyric,r=e.expand,l=e.setExpand,i=e.limit,o=e.locale,s=e.disabled,u=Object(n.useState)(""),d=Object(m.a)(u,2),p=d[0],b=d[1],f=function(e){var t=e.replace(/\s/g,"").trim(),n=[];"ja"===o&&t.split("").forEach((function(e,t,a){var c=a[t+1]||!1;B()(e)&&(L()(e)||(c&&L()(c)?n.push(e+c):n.push(e)))})),"en"===o&&Object(T.toKana)(t).split("").forEach((function(e,t,a){var c=a[t+1]||!1;B()(e)&&(L()(e)||(c&&L()(c)?n.push(Object(T.toRomaji)(e+c)):n.push(Object(T.toRomaji)(e))))})),a(n.slice(0,i))};return Object(n.useEffect)((function(){b(t.join(""))}),[t]),c.a.createElement(h.a,{type:"textarea",className:"lyric-text mr-3 ".concat(r?"lyric-text-expand":""),value:p,placeholder:Object(F.t)("inputLyrics"),onClick:function(){return l(!0)},onChange:function(e){b(e.target.value)},onBlur:function(e){f(e.target.value)},onCompositionEnd:function(e){f(e.target.value)},id:"lyricEditInput",disabled:s})},P=a(178),U=a(164),G=a(165),J=a(168),K=function(e){var t=e.handleClose,a=e.show;return c.a.createElement(P.a,{isOpen:a,size:"lg"},c.a.createElement(U.a,null,Object(F.t)("title")),c.a.createElement(G.a,null,c.a.createElement(O.a,null,c.a.createElement(k.a,{lg:"10",className:"mx-auto text-sm"},c.a.createElement("h2",{className:"h6 font-weight-bold"},Object(F.t)("helpModal.about")),c.a.createElement("ul",null,c.a.createElement("li",null,Object(F.t)("helpModal.about1")),c.a.createElement("li",null,Object(F.t)("helpModal.about2")),c.a.createElement("li",null,Object(F.t)("helpModal.about3"))),c.a.createElement("h2",{className:"h6 font-weight-bold"},Object(F.t)("helpModal.note")),c.a.createElement("ul",null,c.a.createElement("li",null,Object(F.t)("helpModal.note1")),c.a.createElement("li",null,Object(F.t)("helpModal.note2"))),c.a.createElement("h2",{className:"h6 font-weight-bold"},Object(F.t)("helpModal.misc")),c.a.createElement("ul",null,c.a.createElement("li",null,Object(F.t)("helpModal.misc1",{link:c.a.createElement("a",{href:"https://twitter.com/romotco",key:"contact",target:"_blank",rel:"noopener noreferrer"},"@romotco")})),c.a.createElement("li",null,Object(F.t)("helpModal.misc2",{link:c.a.createElement("a",{href:"https://twitter.com/tnantoka",key:"specialThanks",target:"_blank",rel:"noopener noreferrer"},"@tnantoka")})," ",c.a.createElement("a",{href:"https://neutrino.tnantoka.com/",target:"_blank",rel:"noopener noreferrer"},"NEUTRINO BLOG")),c.a.createElement("li",null,Object(F.t)("helpModal.misc3",{link:c.a.createElement("a",{href:"https://www.nicovideo.jp/watch/sm36446234",key:"mySong",target:"_blank",rel:"noopener noreferrer"},"AI Kiritan - Neu Breath (NEUTRINO Original)")}))),c.a.createElement("h2",{className:"h6 font-weight-bold"},"MusicXML"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement("a",{href:"http://usermanuals.musicxml.com/MusicXML/MusicXML.htm#license.htm%3FTocPath%3D_____7",rel:"noopener noreferrer"},"MusicXML3.0 Public License")))))),c.a.createElement(J.a,null,c.a.createElement(b.a,{color:"primary",onClick:t},Object(F.t)("close"))))},X=a(87),z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=["C","C","D","D","E","F","F","G","G","A","A","B"],n=[0,1,0,1,0,0,1,0,1,0,1,0],c=Math.floor(e/12)-1,r=a[e%12],l=n[e%12]+t;return{step:{_text:r},alter:{_text:l>0?"+".concat(l.toString()):l.toString()},octave:{_text:c.toString()}}},H=a(88),V=a.n(H),W=function(e){var t=Object(n.useState)(!1),r=Object(m.a)(t,2),l=r[0],i=r[1],o=Object(n.useState)("ja"===window.navigator.language||"ja-JP"===window.navigator.language?"ja":"en"),q=Object(m.a)(o,2),M=q[0],L=q[1],I=Object(n.useRef)(null),A=Object(n.useRef)(null),B=Object(n.useState)(!1),P=Object(m.a)(B,2),U=P[0],G=P[1],J=Object(n.useState)(0),H=Object(m.a)(J,2),W=H[0],$=H[1],Q=Object(n.useState)(120),Y=Object(m.a)(Q,2),Z=Y[0],ee=Y[1],te=Object(n.useState)(0),ae=Object(m.a)(te,2),ne=ae[0],ce=ae[1],re=Object(n.useState)(!1),le=Object(m.a)(re,2),ie=le[0],oe=le[1],se=Object(n.useState)(24),ue=Object(m.a)(se,2),me=ue[0],de=ue[1],pe=Object(n.useState)(.25),be=Object(m.a)(pe,2),fe=be[0],he=be[1],Ee=Object(n.useState)([""]),ye=Object(m.a)(Ee,2),je=ye[0],ge=ye[1],ve=Object(n.useState)("lyrics"),Oe=Object(m.a)(ve,2),ke=Oe[0],xe=Oe[1],Ne=Object(n.useState)(!1),we=Object(m.a)(Ne,2),_e=we[0],Se=we[1],Ce=Object(n.useState)(!1),qe=Object(m.a)(Ce,2),Me=qe[0],Le=qe[1],Te=Object(n.useState)(!1),Ie=Object(m.a)(Te,2),Re=Ie[0],Ae=Ie[1],Be=function(e){F.lisan.setLocaleName(e),a(155)("./".concat(e,"/main")).then((function(t){F.lisan.add(t),i(!0),L(e),ge("ja"===e?je.map((function(e){return Object(T.toKana)(e)})):je.map((function(e){return Object(T.toRomaji)(e)})))}))};Object(n.useEffect)((function(){M&&Be(M)}),[M]),Object(n.useEffect)((function(){if(l){var e=document.querySelector("#sequence-key-72");null!==e&&e.scrollIntoView(),_e||(Se(!0),Le(!0))}}),[l,_e]);return l?c.a.createElement(c.a.Fragment,null,c.a.createElement(d.Helmet,null,c.a.createElement("title",null,Object(F.t)("title")),c.a.createElement("body",null)),c.a.createElement(p.a,{color:"light",light:!0,className:"fixed-top"},c.a.createElement("div",{className:"d-flex align-items-center mr-auto"},c.a.createElement(b.a,{type:"button",color:U?"secondary":"primary",className:"btn-circle mr-3",onClick:function(){Le(!1),I.current.click()},id:"upload",ref:A},c.a.createElement("i",{className:"icon ri-folder-open-line"})),_e&&c.a.createElement(f.a,{target:"upload",isOpen:Me,delay:4e3,fade:!0},Object(F.t)("startHere")),c.a.createElement("input",{ref:I,type:"file",id:"midi-file-input",className:"d-none",accept:"audio/midi, audio/x-midi",onChange:function(e){var t=e.target.files[0],a=new FileReader;a.readAsArrayBuffer(t),a.onload=function(e){var t=e.target.result;if(t)if(t.tracks<1)window.alert(Object(F.t)("message.noTracks"));else{var a=new X.Midi(t),n=a.header.tempos.length?a.header.tempos.slice(-1)[0].bpm:120;G(a),$(0),ee(n),ge(a.tracks[W].notes.map((function(){return"ja"===M?"\u3089":"ra"}))),de(24),document.querySelector("#sequence-key-72").scrollIntoView(),oe(!0),document.querySelector("#lyricEditInput").focus()}},a.onerror=function(e){window.alert(Object(F.t)("message.failedToLoadFile"))}}}),c.a.createElement("span",{className:"navbar-text mr-2"},Object(F.t)("track")),c.a.createElement(h.a,{type:"select",color:"light",size:"sm",onChange:function(e){$(e.target.value)},style:{width:"120px"},className:"mr-3",disabled:!U},U&&U.toJSON().tracks.map((function(e,t){return c.a.createElement("option",{key:t,value:t},t+1,": ",e.name)}))),c.a.createElement("span",{className:"navbar-text mr-2"},Object(F.t)("bpm")),c.a.createElement(h.a,{type:"number",color:"light",size:"sm",value:Z,onChange:function(e){ee(e.target.value)},style:{width:"70px"},className:"mr-3",disabled:!U}),c.a.createElement("span",{className:"navbar-text mr-2"},Object(F.t)("transpose")),c.a.createElement(h.a,{type:"number",min:"-24",max:"24",size:"sm",value:ne,style:{width:"70px"},onChange:function(e){ce(e.target.value)},disabled:!U})),c.a.createElement(b.a,{color:"primary",onClick:function(){var e=U.toJSON(),t=e.header,a=Array.isArray(t.timeSignatures)&&t.timeSignatures.length>0?t.timeSignatures[0].timeSignature:[4,4],n=e.tracks[W],c=n.notes.slice(-1)[0].durationTicks+n.notes.slice(-1)[0].ticks,r=t.ppq*a[1]*(a[0]/a[1]),l=Math.ceil(c/r),i=Object(u.a)(Array(l).keys()).map((function(e,t){var a=t*r,c=a+r,l=n.notes.map((function(e,t){return c>e.ticks&&(a<=e.ticks||a<e.ticks+e.durationTicks)?Object(s.a)(Object(s.a)({},e),{},{lyric:"ja"===M?je[t]:Object(T.toKana)(je[t])||""}):null})).filter((function(e){return null!==e})),i=[];return 0===l.length?i.push({rest:{},duration:{_text:r}}):l.forEach((function(e,t,n){var r=n[t-1]||!1,l=n[t+1]||!1,o=e.ticks+e.durationTicks,s=!!r&&r.ticks+r.durationTicks;!r&&e.ticks>a?i.push({rest:{},duration:{_text:e.ticks-a}}):!r&&e.ticks<a?i.push({_attributes:{dynamics:100*e.velocity},pitch:z(e.midi,ne),duration:{_text:o-a},tie:{_attributes:{type:"stop"}}}):r&&s<e.ticks&&i.push({rest:{},duration:{_text:e.ticks-s}}),o>c?i.push({_attributes:{dynamics:100*e.velocity},pitch:z(e.midi,ne),duration:{_text:c-e.ticks},lyric:{text:{_text:e.lyric}},tie:{_attributes:{type:"start"}}}):e.ticks>=a&&i.push({_attributes:{dynamics:100*e.velocity},pitch:z(e.midi,ne),duration:{_text:e.durationTicks},lyric:{text:{_text:e.lyric}}}),!l&&c>o&&i.push({rest:{},duration:{_text:c-o}})})),{_attributes:{number:t+2},note:i}}));i.unshift({_attributes:{number:"1"},attributes:{divisions:{_text:t.ppq},key:{fifths:{_text:"0"}},time:{beats:{_text:a[0]},"beat-type":{_text:a[1]}},clef:{sign:{_text:"G"},line:{_text:"2"}}},direction:{_attributes:{placement:"above"},sound:{_attributes:{tempo:Z}}},note:{rest:{},duration:{_text:r}}});var o={_declaration:{_attributes:{version:"1.0",encoding:"utf-8"}},_doctype:'score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd"',"score-partwise":{_attributes:{version:"3.1"},"part-list":{"score-part":{_attributes:{id:"p".concat(W)},"part-name":{_text:t.name||""}}},part:{_attributes:{id:"p".concat(W)},measure:i}}},m=V.a.json2xml(o,{compact:!0,spaces:2}),d=new Blob([m],{type:"text/plain;charset=utf-8"}),p=document.createElement("a");p.download="score.musicxml",p.href=URL.createObjectURL(d),p.click()},className:"mr-1",disabled:!U},Object(F.t)("download"),c.a.createElement("i",{className:"ml-2 icon ri-download-2-line"})),c.a.createElement(E.a,null,c.a.createElement(y.a,{color:"light",className:"btn btn-circle"},c.a.createElement("i",{className:"icon ri-more-2-fill"})),c.a.createElement(j.a,null,c.a.createElement(g.a,{onClick:function(){return Be("en")}},Object(F.t)("english")),c.a.createElement(g.a,{onClick:function(){return Be("ja")}},Object(F.t)("japanese")),c.a.createElement(g.a,{divider:!0}),c.a.createElement(g.a,{onClick:function(){return Ae(!0)}},Object(F.t)("about"))))),c.a.createElement(v.a,{fluid:!0,className:"px-0",style:{marginTop:"53px"}},c.a.createElement(O.a,{className:"no-gutters",onClick:function(){return oe(!1)}},c.a.createElement(k.a,null,c.a.createElement(R,{midi:U,trackIndex:W,transpose:ne,lyric:je,setLyric:ge,xScale:fe,yScale:me,locale:M}))),c.a.createElement(O.a,null,c.a.createElement("div",{className:"sequence-controls"},c.a.createElement("div",{className:"d-flex align-items-start"},c.a.createElement("div",{className:"w-100 p-2"},c.a.createElement(x.a,{pills:!0,className:"mb-2"},c.a.createElement(N.a,null,c.a.createElement(w.a,{href:"#",onClick:function(){xe("lyrics")},active:"lyrics"===ke},Object(F.t)("lyrics"))),c.a.createElement(N.a,null,c.a.createElement(w.a,{href:"#",onClick:function(){xe("velocity")},active:"velocity"===ke,disabled:!0},Object(F.t)("velocity"))),c.a.createElement(N.a,null,c.a.createElement(w.a,{href:"#",onClick:function(){xe("pitch")},active:"pitch"===ke,disabled:!0},Object(F.t)("pitch")))),c.a.createElement(_.a,{activeTab:ke},c.a.createElement(S.a,{tabId:"lyrics"},c.a.createElement(D,{lyric:je,setLyric:ge,expand:ie,setExpand:oe,limit:U?U.tracks[W].notes.length:0,locale:M,disabled:!U}),_e&&c.a.createElement(C.a,{target:"lyricEditInput",fade:!0},Object(F.t)("inputLyrics"))))),c.a.createElement("div",{className:"px-3"},c.a.createElement(h.a,{type:"range",className:"sequence-scale-range",max:"0.5",min:"0.025",step:"0.025",value:fe,onChange:function(e){he(e.target.value)}})))))),c.a.createElement(K,{show:Re,handleClose:function(){Ae(!1)}})):""},$=function(){return c.a.createElement(i.a,{basename:"/midi-musicxml-seq"},c.a.createElement(o.c,null,c.a.createElement(o.a,{exact:!0,path:"/",component:W}),c.a.createElement(o.a,{component:function(){return c.a.createElement("div",null,"404 Not found")}})))};var Q=function(){return c.a.createElement("div",{className:"app"},c.a.createElement("main",{className:"main"},c.a.createElement($,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(c.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},91:function(e,t,a){e.exports=a(158)},96:function(e,t,a){}},[[91,1,2]]]);
//# sourceMappingURL=main.5c964cb8.chunk.js.map