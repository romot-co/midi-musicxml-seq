{"version":3,"sources":["pages/MidiUploadPage.js","components/SequenceKeys.js","components/Note.js","components/Sequence.js","components/LyricEdit.js","utils/convert.js","pages/MidiEditPage.js","App.js","serviceWorker.js","index.js"],"names":["MidiUploadPage","fileInputRef","useRef","history","useHistory","Helmet","Container","Row","Col","className","style","height","Button","type","color","size","onClick","current","click","ref","id","accept","onChange","e","file","target","files","reader","FileReader","readAsArrayBuffer","onload","push","midiData","result","onerror","window","alert","src","alt","href","rel","SequenceKeys","props","keys","octave","mapPitch","0","1","2","3","4","5","6","7","8","9","10","11","map","v","i","Fragment","key","midi","pitch","Note","note","xScale","yScale","transpose","phoneme","lyric","index","edit","setEdit","inputEl","useState","value","setValue","styles","left","ticks","bottom","width","durationTicks","useEffect","select","isEdit","stopPropagation","onKeyPress","toLowerCase","length","hasSmallLetter","maxLength","UncontrolledTooltip","placement","delay","show","name","Sequence","trackIndex","setLyric","pitches","Array","reduce","a","c","slice","oc","n","indexOf","reverse","data","toJSON","header","beats","timeSignatures","timeSignature","notes","tracks","totalTicks","measureTicks","ppq","measuresCount","Math","ceil","maxTicks","setPhoneme","text","nextLyric","o","p","x","_","LyricEdit","expand","setExpand","limit","handleChangeLyric","str","trimed","replace","trim","split","forEach","origin","next","join","Input","onBlur","onCompositionEnd","midiNumberToPitchMusicXML","midiNumber","mapStep","mapAlter","floor","step","alter","_text","toString","MidiEditPage","location","useLocation","setMidi","setTrackIndex","tempo","setTempo","setTranspose","expandLyric","setExpandLyric","setYScale","setXScale","state","Midi","tempos","bpm","document","querySelector","scrollIntoView","Navbar","light","confirm","placeholder","min","max","raw","isArray","track","measures","measureIndex","measureNotes","filter","rest","duration","before","currentLast","beforeLast","_attributes","dynamics","velocity","tie","number","unshift","attributes","divisions","fifths","time","clef","sign","line","direction","sound","json","_declaration","version","encoding","_doctype","part","measure","xml","xmljs","json2xml","compact","spaces","blob","Blob","createElement","download","URL","createObjectURL","fluid","marginTop","Routes","basename","process","exact","path","component","App","Boolean","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","console","message"],"mappings":"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","file":"static/js/main.844140ec.chunk.js","sourcesContent":["import React, { useRef } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Helmet } from 'react-helmet';\nimport { Button, Col, Container, Row } from 'reactstrap';\nimport { FiPlusCircle } from \"react-icons/fi\";\n\nconst MidiUploadPage = () => {\n  const fileInputRef = useRef(null);\n  const history = useHistory();\n  const handleClickUpload = () => {\n    fileInputRef.current.click();\n  };\n  const handleChangeFile = (e) => {\n    const file = e.target.files[0];\n    const reader = new FileReader();\n    reader.readAsArrayBuffer(file);\n    reader.onload = (e) => {\n      history.push('/edit', { midiData: e.target.result });\n    };\n    reader.onerror = (e) => {\n      window.alert('ファイル読み込みに失敗しました');\n    };\n  };\n\n  return (\n    <>\n      <Helmet>\n        <title>MIDIアップロード</title>\n        <body />\n      </Helmet>\n      <Container>\n        <Row>\n          <Col>\n            <div className=\"d-flex align-items-center justify-content-center\" style={{height: '60vh'}}>\n              <div className=\"text-center\">\n                <div className=\"mb-5\">\n                  <h1 className=\"h3\">MIDIから歌詞を入力してMusicXMLにするやつ</h1>\n                  <div className=\"text-muted small\">AIきりたん(NEUTRINO)に歌詞入力をしやすくする目的で<span className=\"text-danger font-weight-bold\">開発実験中</span></div>\n                </div>\n                <Button type=\"button\" color=\"primary\" size=\"lg\" className=\"font-weight-bold\" onClick={handleClickUpload}>\n                  <FiPlusCircle />{' '}MIDIファイルを選択してはじめる\n                </Button>\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  id=\"midi-file-input\"\n                  className=\"d-none\"\n                  accept=\"audio/midi, audio/x-midi\"\n                  onChange={handleChangeFile}\n                />\n              </div>\n            </div>\n            <div className=\"text-center mb-4\">\n              <img src=\"./temp-scr.png\" alt=\"temp-scr\" style={{height: '30vh'}} />\n            </div>\n            <div className=\"text-muted text-center small\">\n              <div>概要と注意点を読んで自己責任でご利用ください</div>\n              <div>バグ報告 <a href=\"https://twitter.com/romotco\" target=\"_blank\" rel=\"noopener noreferrer\">Twitter @romotco</a> までいただけると助かります</div>\n            </div>\n          </Col>\n        </Row>\n        <hr className=\"mb-5\" />\n        <Row>\n          <Col>\n            <div className=\"d-flex my-2\">\n              <div className=\"mx-auto\">\n                <h2 className=\"h6 font-weight-bold\">概要</h2>\n                <ul>\n                  <li>MIDIファイルに歌詞をまとめて/個別に入力してNEUTRINOで使えるMusicXMLにします</li>\n                  <li>MIDIファイルはどこにもアップロードされません(PC内で動きます)</li>\n                  <li>Reactで適当につくっています</li>\n                </ul>\n                <h2 className=\"h6 font-weight-bold\">使い方</h2>\n                <ul>\n                  <li>上の青いボタンからMIDIファイルを指定</li>\n                  <li>ノートをクリックし<span className=\"font-weight-bold\">ひらがな</span>で歌詞入力＆EnterあるいはTabキーで次へ移動</li>\n                  <li>あるいは画面下部の歌詞入力で<span className=\"font-weight-bold\">ひらがな</span>でまとめて歌詞入力</li>\n                  <li>ダウンロードボタンでMusicXMLファイルをダウンロード</li>\n                </ul>\n                <h2 className=\"h6 font-weight-bold\">注意点</h2>\n                <ul>\n                  <li>NEUTRINOでしか鳴りません</li>\n                  <li>NEUTRINOでもおかしいかもしれません</li>\n                  <li>いまのところ<span className=\"font-weight-bold\">ひらがなのみ</span>です</li>\n                  <li>いまのところMIDIトラックは1番目固定です</li>\n                  <li>いまのところ単音のみの対応です(ノートの重なりや和音は死にます)</li>\n                  <li>MIDIノートの追加・変更・削除はできません</li>\n                </ul>\n                <h2 className=\"h6 font-weight-bold\">変更予定</h2>\n                <ul>\n                  <li>日本語においてひらがな入力以外の拒否あるいは変換</li>\n                  <li>ローマ字(英字)による入力</li>\n                  <li>MusicXMLの仕様準拠(MuseScoreとの互換)</li>\n                  <li>重なったノートの修正や和音への対応</li>\n                  <li>MIDIトラックの選択</li>\n                  <li>デザインをよくする</li>\n                </ul>\n                <h2 className=\"h6 font-weight-bold\">夢</h2>\n                <ul>\n                  <li>MIDIシーケンサ化</li>\n                  <li>VSQ対応</li>\n                  <li>ReactNativeとかで直接NEUTRINOから出力できないかな</li>\n                </ul>\n              </div>\n            </div>\n          </Col>\n        </Row>\n        <hr className=\"mb-5\" />\n        <Row>\n          <Col>\n            <div className=\"d-flex my-2 mb-5\">\n              <div className=\"mx-auto\">\n                <h2 className=\"h6 font-weight-bold\">謝辞</h2>\n                <ul>\n                  <li>\n                    <a href=\"https://twitter.com/tnantoka\" target=\"_blank\" rel=\"noopener noreferrer\">@tnantoka</a>さまの<a href=\"https://neutrino.tnantoka.com/\">NEUTRINOのブログ</a>を大きく参考にさせていただいております。<br />ありがとうございます。\n                  </li>\n                </ul>\n                <h2 className=\"h6 font-weight-bold\">MusicXML</h2>\n                <ul>\n                  <li><a href=\"http://usermanuals.musicxml.com/MusicXML/MusicXML.htm#license.htm%3FTocPath%3D_____7\">MusicXML3.0 Public License</a></li>\n                </ul>\n                <h2 className=\"h6 font-weight-bold\">宣伝</h2>\n                AIきりたん(NEUTRINO)で<a href=\"https://www.nicovideo.jp/watch/sm36446234\" target=\"_blank\" rel=\"noopener noreferrer\">オリジナル曲</a>つくっているのでよければどうぞ。\n                <script type=\"application/javascript\" src=\"https://embed.nicovideo.jp/watch/sm36446234/script?w=640&h=360&from=74\"></script><noscript><a href=\"https://www.nicovideo.jp/watch/sm36446234?from=74\">AIきりたん - Neu Breath 【NEUTRINOオリジナル】</a></noscript>\n              </div>\n            </div>\n          </Col>\n        </Row>\n      </Container>\n    </>\n  )\n}\n\nexport default MidiUploadPage;\n","import React from 'react';\n\nconst SequenceKeys = props => {\n  const { keys, octave } = props;\n  const mapPitch = {\n    0: 'C',\n    1: 'C#',\n    2: 'D',\n    3: 'D#',\n    4: 'E',\n    5: 'F',\n    6: 'F#',\n    7: 'G',\n    8: 'G#',\n    9: 'A',\n    10: 'A#',\n    11: 'B',\n  };\n\n  return (\n    <div className=\"sequence-keys\">\n      { keys.map((v,i) => (\n        <React.Fragment key={i}>\n          <div className={`sequence-key sequence-key-${v.midi} sequence-key-${v.color} sequence-key-${v.pitch}`} id={`sequence-key-${v.midi}`}>\n            <span className=\"sequence-key-base\">{mapPitch[v.pitch]}{octave + 1}</span>\n          </div>\n          {/*\n          <UncontrolledTooltip\n            target={`sequence-key-${v.midi}`} placement=\"right\"\n          >\n            {mapPitch[v.pitch]}{octave}\n          </UncontrolledTooltip>\n          */}\n        </React.Fragment>\n      ))}\n    </div>\n  );\n};\n\nexport default SequenceKeys;\n","import React, { useState, useEffect, useRef } from 'react';\nimport hasSmallLetter from 'jaco/fn/hasSmallLetter';\nimport { UncontrolledTooltip } from 'reactstrap';\n\nconst Note = props => {\n  const { note, xScale, yScale, transpose, phoneme, lyric, index, edit, setEdit, onChange } = props;\n  const inputEl = useRef(null);\n  const [value, setValue] = useState('');\n  const styles = {\n    left: `${note.ticks * xScale}px`,\n    bottom: `${(note.midi - 12) * yScale + (transpose * yScale)}px`,\n    width: `${note.durationTicks * xScale}px`,\n  };\n  const handleClick = (e) => {\n    e.stopPropagation();\n    if (!edit) {\n      setEdit(index);\n      inputEl && inputEl.current.select();\n    }\n  };\n  const handleKeyPress = (e) => {\n    const key = e.key.toLowerCase();\n    if (key === 'enter' || (key === 'tab' && lyric.length < index)) {\n      setEdit(index + 1);\n    }\n  };\n\n  const handleChange = (e) => {\n    setValue(e.target.value);\n    if (!e.target.value) {\n      return;\n    } else if (e.target.value.length === 1) {\n      onChange(e.target.value[0], index);\n    } else if (hasSmallLetter(e.target.value)) {\n      onChange(e.target.value, index);\n    };\n  };\n\n  useEffect(() => {\n    setValue(phoneme);\n  }, [phoneme]);\n\n  useEffect(() => {\n    if (edit === index) {\n      inputEl.current.select();\n    }\n  }, [edit]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const isEdit = edit === index;\n\n  return (\n    <div className=\"note\" onClick={handleClick} style={styles}>\n      <input\n        type=\"text\"\n        value={value || ''}\n        onKeyPress={handleKeyPress}\n        onChange={handleChange}\n        className=\"note-input\"\n        maxLength=\"3\"\n        ref={inputEl}\n        id={`note-${index}`}\n      />\n      {!isEdit &&\n        <UncontrolledTooltip\n          target={`note-${index}`}\n          placement=\"bottom\"\n          delay={{\n            show: 200,\n          }}\n        >{value}{' '}<span className=\"text-muted\">{note.name}</span></UncontrolledTooltip>\n      }\n    </div>\n  );\n};\n\nexport default Note;\n","import React, { useState } from 'react';\nimport SequenceKeys from 'components/SequenceKeys';\nimport Note from 'components/Note';\n\nconst Sequence = props => {\n  const { midi, trackIndex = 0, transpose = 0, lyric, setLyric, xScale, yScale } = props;\n  const pitches = [...Array(128).keys()]\n    .reduce((a, c, i) => i % 12 === 0 ? [...a, [c]] : [...a.slice(0, -1), [...a[a.length - 1], c]], [])\n    .map((v,oc) => v.map((n,i) => {\n      return {\n        midi: n,\n        pitch: i,\n        octave: 9 - oc,\n        color: [0,2,4,5,7,9,11].indexOf(i) > -1 ? 'white' : 'black',\n      }\n    }).reverse()).reverse();\n  const data = midi && midi.toJSON();\n  const header = data.header;\n  const beats = (data && header.timeSignatures && header.timeSignatures.length > 0) ? header.timeSignatures[0].timeSignature : [4,4];\n  const notes = data && data.tracks[trackIndex].notes;\n  const totalTicks = notes ? (notes.slice(-1)[0].ticks + notes.slice(-1)[0].durationTicks) : 7680;\n  const ppq = data ? header.ppq : 480;\n  const measureTicks = ppq * beats[1] * (beats[0] / beats[1]);\n  const measuresCount = Math.ceil(totalTicks / measureTicks);\n  const maxTicks = measureTicks * measuresCount;\n  const setPhoneme = (text, index) => {\n    const nextLyric = lyric.map((v,i) => i === index ? text : v);\n    setLyric(nextLyric);\n  };\n  const [edit, setEdit] = useState(false);\n  return (\n    <div className=\"sequence\">\n      <div className=\"sequence-scales\">\n        {\n          pitches.map((v,i,o) => (\n            <SequenceKeys keys={v} octave={9 - i} key={i} />\n          ))\n        }\n      </div>\n      <div className=\"sequence-body\">\n        <div className=\"sequence-grid-y\" style={{width: `${maxTicks * xScale}px`}} onClick={() => setEdit(false)}>\n          { pitches.map((v,i,o) => (\n            <div className=\"sequence-grid-octave\" key={i}>\n              { v.map((p,x) => (\n                <div key={x} className={`sequence-grid-pitch sequence-grid-pitch-${p.color}`} />\n              ))}\n            </div>\n          ))}\n        </div>\n        <div className=\"sequence-grid-x\">\n          { [...Array(measuresCount).keys()].map((_,i) => (\n            <div className=\"sequence-grid-measure\" key={i} style={{left: `${measureTicks * xScale * (i + 1)}px`}} />\n          )) }\n        </div>\n        { midi && data.tracks[trackIndex].notes.map((v,i) => (\n          <Note\n            note={v}\n            xScale={xScale}\n            yScale={yScale}\n            transpose={transpose}\n            key={i}\n            phoneme={lyric[i]}\n            edit={edit}\n            setEdit={setEdit}\n            index={i}\n            lyric={lyric}\n            onChange={setPhoneme}\n          />\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default Sequence;\n","import React, { useState, useEffect } from 'react';\nimport { Input } from 'reactstrap';\nimport hasSmallLetter from 'jaco/fn/hasSmallLetter';\n\nconst LyricEdit = props => {\n  const { lyric, setLyric, expand, setExpand, limit } = props;\n  const [value, setValue] = useState('');\n  const handleChangeLyric = (str) => {\n    const trimed = str.replace(/\\s/g, '').trim();\n    let nextLyric = [];\n    trimed.split('').forEach((current,i,origin) => {\n      const next = origin[i+1] || false;\n      if (hasSmallLetter(current)) { return; }\n      if (next && hasSmallLetter(next)) {\n        nextLyric.push(current + next);\n      } else {\n        nextLyric.push(current);\n      }\n    });\n    setLyric(nextLyric.slice(0,limit));\n  };\n\n  const handleChange = (e) => {\n    setValue(e.target.value);\n  };\n\n  const handleCompositionEnd = (e) => {\n    handleChangeLyric(e.target.value);\n  };\n\n  const handleBlur = (e) => {\n    handleChangeLyric(e.target.value);\n  };\n\n  useEffect(() => {\n    setValue(lyric.join(''));\n  }, [lyric]);\n\n  return (\n    <Input\n      type=\"textarea\"\n      className={`lyric-text mr-3 ${expand ? 'lyric-text-expand' : ''}`}\n      value={value}\n      onClick={() => setExpand(true)}\n      onChange={handleChange}\n      onBlur={handleBlur}\n      onCompositionEnd={handleCompositionEnd}\n    />\n  );\n};\n\nexport default LyricEdit;\n","export const midiNumberToPitchMusicXML = (midiNumber, transpose = 0) => {\n  const mapStep = [\n    'C','C','D','D','E','F','F','G','G','A','A','B',\n  ];\n  const mapAlter = [\n    0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0,\n  ];\n  const octave = Math.floor(midiNumber / 12) - 1;\n  const step = mapStep[midiNumber % 12];\n  const alter = mapAlter[midiNumber % 12] + transpose;\n  return {\n    step: {\n      _text: step,\n    },\n    alter: {\n      _text: alter > 0 ? `+${alter.toString()}` : alter.toString()\n    },\n    octave: {\n      _text: octave.toString(),\n    },\n  };\n};\n","import React, { useState, useEffect } from 'react';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport { Helmet } from 'react-helmet';\nimport { Button, Col, Container, Input, Navbar, Row } from 'reactstrap';\nimport Sequence from 'components/Sequence';\nimport LyricEdit from 'components/LyricEdit';\nimport { Midi } from '@tonejs/midi';\nimport { midiNumberToPitchMusicXML } from 'utils/convert';\nimport { FiX } from \"react-icons/fi\";\nimport xmljs from 'xml-js';\n\nconst MidiEditPage = (props) => {\n  const history = useHistory();\n  const location = useLocation();\n  const [midi, setMidi] = useState(false);\n  const [trackIndex, setTrackIndex] = useState(0);\n  const [tempo, setTempo] = useState(120);\n  const [transpose, setTranspose] = useState(0);\n  const [expandLyric, setExpandLyric] = useState(false);\n  const [yScale, setYScale] = useState(24); // temporary\n  const [xScale, setXScale] = useState(0.25);\n  const [lyric, setLyric] = useState([]);\n  useEffect(\n    () => {\n      const midiData = location.state && location.state.midiData;\n      if (midiData) {\n        if (midiData.tracks < 1) {\n          window.alert('トラックがありません');\n          history.push('/');\n        } else {\n          const midi = new Midi(midiData);\n          const tempo = midi.header.tempos.length ? midi.header.tempos.slice(-1)[0].bpm : 120;\n          setMidi(midi);\n          setTrackIndex(0);\n          setTempo(tempo);\n          setLyric(midi.tracks[trackIndex].notes.map(() => 'ら'));\n          setYScale(24); //temporary\n        }\n      }\n    },\n    [location.state], // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  useEffect(\n    () => {\n      document.querySelector('#sequence-key-70').scrollIntoView();\n    },\n    [],\n  );\n\n  const handleClose = () => {\n    if (window.confirm('データは保存されません')) {\n      setMidi(false);\n      history.push('/');\n    }\n  };\n  const handleChangeTrack = (e) => {\n    setTrackIndex(e.target.value);\n  };\n  const handleChangeTempo = (e) => {\n    setTempo(e.target.value);\n  };\n  const handleChangeXScale = (e) => {\n    setXScale(e.target.value);\n  };\n  const handleChangeTranspose = (e) => {\n    setTranspose(e.target.value);\n  };\n  const handleGenerateMusicXML = () => {\n    const raw = midi.toJSON();\n    const header = raw.header;\n    const beats = Array.isArray(header.timeSignatures) && header.timeSignatures.length > 0 ? header.timeSignatures[0].timeSignature : [4,4];\n    const track = raw.tracks[trackIndex];\n    const totalTicks = track.notes.slice(-1)[0].durationTicks + track.notes.slice(-1)[0].ticks;\n    const measureTicks = header.ppq * beats[1] * (beats[0] / beats[1]);\n    const measuresCount = Math.ceil(totalTicks / measureTicks);\n    let measures = [...Array(measuresCount).keys()].map((_,measureIndex) => {\n      const min = measureIndex * measureTicks;\n      const max = min + measureTicks;\n      const measureNotes = track.notes.map((note, index) => {\n        if (max > note.ticks && (min <= note.ticks || min < (note.ticks + note.durationTicks))) {\n          return {\n            ...note,\n            lyric: lyric[index] || '',\n          };\n        } else {\n          return null;\n        }\n      }).filter(v => v !== null);\n      let notes = [];\n      // full rest\n      if (measureNotes.length === 0) {\n        notes.push({\n          rest: {},\n          duration: {\n            _text: measureTicks\n          },\n        });\n      } else {\n        measureNotes.forEach((current, index, origin) => {\n          const before = origin[index - 1] || false;\n          const next = origin[index + 1] || false;\n          const currentLast = current.ticks + current.durationTicks;\n          const beforeLast = before ? before.ticks + before.durationTicks : false;\n\n          // First note = rest\n          if (!before && current.ticks > min) {\n            notes.push({\n              rest: {},\n              duration: {\n                _text: current.ticks - min,\n              }\n            });\n          // First note = tied stop\n          } else if (!before && current.ticks < min) {\n            notes.push({\n              _attributes: {\n                dynamics: current.velocity * 100,\n              },\n              pitch: midiNumberToPitchMusicXML(current.midi, transpose),\n              duration: {\n                _text: currentLast - min,\n              },\n              tie: {\n                _attributes: {\n                  type: 'stop',\n                },\n              }\n            });\n          // Rest note between before to current\n          } else if (before && beforeLast < current.ticks) {\n            notes.push({\n              rest: {},\n              duration: {\n                _text: current.ticks - beforeLast,\n              }\n            });\n          }\n          // Last note = tied start\n          if (currentLast > max) {\n            notes.push({\n              _attributes: {\n                dynamics: current.velocity * 100,\n              },\n              pitch: midiNumberToPitchMusicXML(current.midi, transpose),\n              duration: {\n                _text: max - current.ticks,\n              },\n              lyric: {\n                text: {_text: current.lyric,}\n              },\n              tie: {\n                _attributes: {\n                  type: 'start',\n                },\n              }\n            });\n          } else if (current.ticks >= min) {\n            // current note\n            //const currentDurationTicks = next && next.ticks >= currentLast ? current.durationTicks - (next.ticks - currentLast) : current.durationTicks;\n            notes.push({\n              _attributes: {\n                dynamics: current.velocity * 100,\n              },\n              pitch: midiNumberToPitchMusicXML(current.midi, transpose),\n              duration: {\n                _text: current.durationTicks,\n              },\n              lyric: {\n                text: {_text: current.lyric,}\n              },\n            });\n          };\n          // last note = rest\n          if (!next && max > (currentLast)) {\n            notes.push({\n              rest: {},\n              duration: {\n                _text: max - currentLast,\n              }\n            });\n          };\n        });\n      }\n      return {\n        _attributes: {\n          number: measureIndex + 2,\n        },\n        note: notes,\n      };\n    });\n\n    measures.unshift({\n      _attributes: {\n        number: '1',\n      },\n      attributes: {\n        divisions: {_text: header.ppq},\n        key: {\n          fifths: {_text: '0'},\n        },\n        time: {\n          beats: {\n            _text: beats[0],\n          },\n          'beat-type': {\n            _text: beats[1],\n          },\n        },\n        clef: {\n          sign: {_text: 'G'},\n          line: {_text: '2'},\n        },\n      },\n      direction: {\n        _attributes: {\n          placement: 'above',\n        },\n        sound: {\n          _attributes: {\n            tempo: tempo,\n          }\n        },\n      },\n      note: {\n        rest: {},\n        duration: {\n          _text: measureTicks,\n        }\n      },\n    });\n    const json = {\n      _declaration: {\n        _attributes: {\n          version: '1.0',\n          encoding:'utf-8'\n        }\n      },\n      _doctype: 'score-partwise PUBLIC \"-//Recordare//DTD MusicXML 3.1 Partwise//EN\" \"http://www.musicxml.org/dtds/partwise.dtd\"',\n      'score-partwise': {\n        _attributes: {\n          version: '3.1',\n        },\n        'part-list': {\n          'score-part': {\n            _attributes: {\n              id: `p${trackIndex}`,\n            },\n            'part-name': {\n              _text: header.name || '',\n            },\n          },\n        },\n        part: {\n          _attributes: {\n            id: `p${trackIndex}`,\n          },\n          measure: measures,\n        },\n      },\n    };\n    const xml = xmljs.json2xml(json, {compact: true, spaces: 2});\n    const blob = new Blob([xml], {\n      type: 'text/plain;charset=utf-8',\n    });\n    const a = document.createElement('a');\n    a.download = 'score.musicxml';\n    a.href = URL.createObjectURL(blob);\n    a.click();\n  };\n  return (\n    <>\n      <Helmet>\n        <title>MIDI編集</title>\n        <body />\n      </Helmet>\n      <Navbar color=\"light\" light className=\"fixed-top\">\n        <div className=\"d-flex align-items-center mr-auto\">\n          <Button className=\"rounded-circle mr-3 btn-icon\" color=\"light\" onClick={handleClose}>\n            <FiX />\n          </Button>\n          <span className=\"mr-2\">トラック</span>\n          <Input\n            type=\"select\"\n            color=\"light\"\n            onChange={handleChangeTrack}\n            style={{width: '120px'}}\n            className=\"mr-3\"\n          >\n            {midi && midi.toJSON().tracks.map((v,i) => <option key={i} value={i}>{i+1}: {v.name}</option>)}\n          </Input>\n          <span className=\"mr-2\">BPM</span>\n          <Input\n            type=\"number\"\n            color=\"light\"\n            placeholder=\"テンポ\"\n            value={tempo}\n            onChange={handleChangeTempo}\n            style={{width: '70px'}}\n            className=\"mr-3\"\n          />\n          <span className=\"mr-2\">キー</span>\n          <Input\n            type=\"number\"\n            min=\"-24\"\n            max=\"24\"\n            value={transpose}\n            style={{width: '70px'}}\n            onChange={handleChangeTranspose}\n          />\n        </div>\n        <Button color=\"primary\" onClick={handleGenerateMusicXML}>\n          ダウンロード\n        </Button>\n      </Navbar>\n      <Container fluid className=\"px-0\" style={{marginTop: '56px'}}>\n        <Row className=\"no-gutters\" onClick={() => setExpandLyric(false)}>\n          <Col>\n            <Sequence\n              midi={midi}\n              trackIndex={trackIndex}\n              transpose={transpose}\n              lyric={lyric}\n              setLyric={setLyric}\n              xScale={xScale}\n              yScale={yScale}\n            />\n          </Col>\n        </Row>\n        <Row>\n          <div className=\"sequence-controls\">\n            <div className=\"d-flex align-items-start p-3\">\n              <LyricEdit\n                lyric={lyric}\n                setLyric={setLyric}\n                expand={expandLyric}\n                setExpand={setExpandLyric}\n                limit={midi ? midi.tracks[trackIndex].notes.length : 0}\n              />\n              <Input\n                type=\"range\"\n                className=\"sequence-scale-range\"\n                max=\"0.5\"\n                min=\"0.025\"\n                step=\"0.025\"\n                value={xScale}\n                onChange={handleChangeXScale}\n              />\n            </div>\n          </div>\n        </Row>\n      </Container>\n    </>\n  )\n}\n\nexport default MidiEditPage;\n","import React from 'react';\nimport {\n  BrowserRouter,\n  Switch,\n  Route,\n} from \"react-router-dom\";\n\nimport MidiUploadPage from 'pages/MidiUploadPage';\nimport MidiEditPage from 'pages/MidiEditPage';\n\nconst Routes = () => {\n  return (\n    <BrowserRouter basename={process.env.PUBLIC_URL}>\n      <Switch>\n        <Route exact path=\"/\" component={MidiUploadPage} />\n        <Route path=\"/edit\" component={MidiEditPage} />\n        <Route component={() => (<div>404 Not found</div>)} />\n      </Switch>\n    </BrowserRouter>\n  );\n}\n\nfunction App() {\n  return (\n    <div className=\"app\">\n      <main className=\"main\">\n        <Routes />\n      </main>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'scss/index.scss';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}