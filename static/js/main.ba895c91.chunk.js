(this["webpackJsonpmidi-musicxml-seq"]=this["webpackJsonpmidi-musicxml-seq"]||[]).push([[0],{140:function(e,t){},142:function(e,t){},154:function(e,t,a){var n={"./en/main":[159,3],"./ja/main":[160,4]};function c(e){if(!a.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],c=t[0];return a.e(t[1]).then((function(){return a.t(c,7)}))}c.keys=function(){return Object.keys(n)},c.id=154,e.exports=c},157:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),r=a(19),l=a.n(r),i=(a(96),a(88)),s=a(21),o=a(57),u=a(22),m=a(11),d=a(81),p=a(168),b=a(85),f=a(56),h=a(162),E=a(178),y=a(179),g=a(169),v=a(170),k=a(171),O=a(165),j=a(166),x=a(172),w=a(173),N=a(174),_=a(175),S=a(176),C=a(161),q=function(e){var t=e.keys,a=e.octave,n={0:"C",1:"C#",2:"D",3:"D#",4:"E",5:"F",6:"F#",7:"G",8:"G#",9:"A",10:"A#",11:"B"};return c.a.createElement("div",{className:"sequence-keys"},t.map((function(e,t){return c.a.createElement(c.a.Fragment,{key:t},c.a.createElement("div",{className:"sequence-key sequence-key-".concat(e.midi," sequence-key-").concat(e.color," sequence-key-").concat(e.pitch),id:"sequence-key-".concat(e.midi)},c.a.createElement("span",{className:"sequence-key-base"},n[e.pitch],a+1)),c.a.createElement(C.a,{target:"sequence-key-".concat(e.midi),placement:"right"},n[e.pitch],a))})))},M=a(30),L=a.n(M),T=function(e){var t=e.note,a=e.xScale,r=e.yScale,l=e.transpose,i=e.phoneme,s=e.lyric,o=e.index,u=e.edit,d=e.setEdit,p=e.onChange,b=Object(n.useRef)(null),f=Object(n.useState)(""),h=Object(m.a)(f,2),E=h[0],y=h[1],g={left:"".concat(t.ticks*a,"px"),bottom:"".concat((t.midi-12)*r+l*r,"px"),width:"".concat(t.durationTicks*a,"px")};Object(n.useEffect)((function(){y(i)}),[i]),Object(n.useEffect)((function(){u===o&&b.current.select()}),[u]);var v=u===o;return c.a.createElement("div",{className:"note",onClick:function(e){e.stopPropagation(),u||(d(o),b&&b.current.select())},style:g},c.a.createElement("input",{type:"text",value:E||"",onKeyPress:function(e){var t=e.key.toLowerCase();("enter"===t||"tab"===t&&s.length<o)&&d(o+1)},onChange:function(e){y(e.target.value),e.target.value&&(1===e.target.value.length?p(e.target.value[0],o):L()(e.target.value)&&p(e.target.value,o))},className:"note-input",maxLength:"3",ref:b,id:"note-".concat(o)}),!v&&c.a.createElement(C.a,{target:"note-".concat(o),placement:"bottom",delay:{show:200}},E," ",c.a.createElement("span",{className:"text-muted"},t.name)))},A=function(e){var t=e.midi,a=e.trackIndex,r=void 0===a?0:a,l=e.transpose,i=void 0===l?0:l,s=e.lyric,o=e.setLyric,d=e.xScale,p=e.yScale,b=Object(u.a)(Array(128).keys()).reduce((function(e,t,a){return a%12===0?[].concat(Object(u.a)(e),[[t]]):[].concat(Object(u.a)(e.slice(0,-1)),[[].concat(Object(u.a)(e[e.length-1]),[t])])}),[]).map((function(e,t){return e.map((function(e,a){return{midi:e,pitch:a,octave:9-t,color:[0,2,4,5,7,9,11].indexOf(a)>-1?"white":"black"}})).reverse()})).reverse(),f=t&&t.toJSON(),h=f.header,E=f&&h.timeSignatures&&h.timeSignatures.length>0?h.timeSignatures[0].timeSignature:[4,4],y=f&&f.tracks[r].notes,g=y?y.slice(-1)[0].ticks+y.slice(-1)[0].durationTicks:7680,v=(f?h.ppq:480)*E[1]*(E[0]/E[1]),k=Math.ceil(g/v),O=v*k,j=function(e,t){var a=s.map((function(a,n){return n===t?e:a}));o(a)},x=Object(n.useState)(!1),w=Object(m.a)(x,2),N=w[0],_=w[1];return c.a.createElement("div",{className:"sequence"},c.a.createElement("div",{className:"sequence-scales"},b.map((function(e,t,a){return c.a.createElement(q,{keys:e,octave:9-t,key:t})}))),c.a.createElement("div",{className:"sequence-body"},c.a.createElement("div",{className:"sequence-grid-y",style:{width:"".concat(O*d,"px")},onClick:function(){return _(!1)}},b.map((function(e,t,a){return c.a.createElement("div",{className:"sequence-grid-octave",key:t},e.map((function(e,t){return c.a.createElement("div",{key:t,className:"sequence-grid-pitch sequence-grid-pitch-".concat(e.color)})})))}))),c.a.createElement("div",{className:"sequence-grid-x"},Object(u.a)(Array(k).keys()).map((function(e,t){return c.a.createElement("div",{className:"sequence-grid-measure",key:t,style:{left:"".concat(v*d*(t+1),"px")}})}))),t&&f.tracks[r].notes.map((function(e,t){return c.a.createElement(T,{note:e,xScale:d,yScale:p,transpose:i,key:t,phoneme:s[t],edit:N,setEdit:_,index:t,lyric:s,onChange:j})}))))},I=a(84),B=a.n(I),F=function(e){var t=e.lyric,a=e.setLyric,r=e.expand,l=e.setExpand,i=e.limit,s=e.disabled,o=Object(n.useState)(""),u=Object(m.a)(o,2),d=u[0],p=u[1],b=function(e){var t=e.replace(/\s/g,"").trim(),n=[];t.split("").forEach((function(e,t,a){var c=a[t+1]||!1;B()(e)&&(L()(e)||(c&&L()(c)?n.push(e+c):n.push(e)))})),a(n.slice(0,i))};return Object(n.useEffect)((function(){p(t.join(""))}),[t]),c.a.createElement(h.a,{type:"textarea",className:"lyric-text mr-3 ".concat(r?"lyric-text-expand":""),value:d,onClick:function(){return l(!0)},onChange:function(e){p(e.target.value)},onBlur:function(e){b(e.target.value)},onCompositionEnd:function(e){b(e.target.value)},id:"lyricEditInput",disabled:s})},D=a(177),R=a(163),P=a(164),U=a(167),G=a(8),J=function(e){var t=e.handleClose,a=e.show;return c.a.createElement(D.a,{isOpen:a,size:"lg"},c.a.createElement(R.a,null,Object(G.t)("title")),c.a.createElement(P.a,null,c.a.createElement(O.a,null,c.a.createElement(j.a,{lg:"10",className:"mx-auto text-sm"},c.a.createElement("h2",{className:"h6 font-weight-bold"},Object(G.t)("helpModal.about")),c.a.createElement("ul",null,c.a.createElement("li",null,Object(G.t)("helpModal.about1")),c.a.createElement("li",null,Object(G.t)("helpModal.about2")),c.a.createElement("li",null,Object(G.t)("helpModal.about3"))),c.a.createElement("h2",{className:"h6 font-weight-bold"},Object(G.t)("helpModal.note")),c.a.createElement("ul",null,c.a.createElement("li",null,Object(G.t)("helpModal.note1")),c.a.createElement("li",null,Object(G.t)("helpModal.note2"))),c.a.createElement("h2",{className:"h6 font-weight-bold"},Object(G.t)("helpModal.misc")),c.a.createElement("ul",null,c.a.createElement("li",null,Object(G.t)("helpModal.misc1",{link:c.a.createElement("a",{href:"https://twitter.com/romotco",key:"contact",target:"_blank",rel:"noopener noreferrer"},"@romotco")})),c.a.createElement("li",null,Object(G.t)("helpModal.misc2",{link:c.a.createElement("a",{href:"https://twitter.com/tnantoka",key:"specialThanks",target:"_blank",rel:"noopener noreferrer"},"@tnantoka")})," ",c.a.createElement("a",{href:"https://neutrino.tnantoka.com/",target:"_blank",rel:"noopener noreferrer"},"NEUTRINO BLOG")),c.a.createElement("li",null,Object(G.t)("helpModal.misc3",{link:c.a.createElement("a",{href:"https://www.nicovideo.jp/watch/sm36446234",key:"mySong",target:"_blank",rel:"noopener noreferrer"},"AI Kiritan - Neu Breath (NEUTRINO Original)")}))),c.a.createElement("h2",{className:"h6 font-weight-bold"},"MusicXML"),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement("a",{href:"http://usermanuals.musicxml.com/MusicXML/MusicXML.htm#license.htm%3FTocPath%3D_____7",rel:"noopener noreferrer"},"MusicXML3.0 Public License")))))),c.a.createElement(U.a,null,c.a.createElement(b.a,{color:"primary",onClick:t},Object(G.t)("close"))))},X=a(86),z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=["C","C","D","D","E","F","F","G","G","A","A","B"],n=[0,1,0,1,0,0,1,0,1,0,1,0],c=Math.floor(e/12)-1,r=a[e%12],l=n[e%12]+t;return{step:{_text:r},alter:{_text:l>0?"+".concat(l.toString()):l.toString()},octave:{_text:c.toString()}}},H=a(90),K=a(87),V=a.n(K),W=function(e){var t=Object(n.useState)(!1),r=Object(m.a)(t,2),l=r[0],i=r[1],s=Object(n.useState)("ja"===window.navigator.language||"ja-JP"===window.navigator.language?"ja":"en"),C=Object(m.a)(s,2),q=C[0],M=C[1],L=Object(n.useRef)(null),T=Object(n.useRef)(null),I=Object(n.useState)(!1),B=Object(m.a)(I,2),D=B[0],R=B[1],P=Object(n.useState)(0),U=Object(m.a)(P,2),K=U[0],W=U[1],$=Object(n.useState)(120),Q=Object(m.a)($,2),Y=Q[0],Z=Q[1],ee=Object(n.useState)(0),te=Object(m.a)(ee,2),ae=te[0],ne=te[1],ce=Object(n.useState)(!1),re=Object(m.a)(ce,2),le=re[0],ie=re[1],se=Object(n.useState)(24),oe=Object(m.a)(se,2),ue=oe[0],me=oe[1],de=Object(n.useState)(.25),pe=Object(m.a)(de,2),be=pe[0],fe=pe[1],he=Object(n.useState)([""]),Ee=Object(m.a)(he,2),ye=Ee[0],ge=Ee[1],ve=Object(n.useState)("lyrics"),ke=Object(m.a)(ve,2),Oe=ke[0],je=ke[1],xe=Object(n.useState)(!1),we=Object(m.a)(xe,2),Ne=we[0],_e=we[1],Se=Object(n.useState)(!1),Ce=Object(m.a)(Se,2),qe=Ce[0],Me=Ce[1],Le=Object(n.useState)(!1),Te=Object(m.a)(Le,2),Ae=Te[0],Ie=Te[1];Object(n.useEffect)((function(){Be(q)}),[q]),Object(n.useEffect)((function(){if(l){var e=document.querySelector("#sequence-key-72");null!==e&&e.scrollIntoView(),Ne||(_e(!0),Me(!0))}}),[l,Ne]);var Be=function(e){G.lisan.setLocaleName(e),a(154)("./".concat(e,"/main")).then((function(t){G.lisan.add(t),i(!0),M(e)}))};return l?c.a.createElement(c.a.Fragment,null,c.a.createElement(d.Helmet,null,c.a.createElement("title",null,Object(G.t)("title")),c.a.createElement("body",null)),c.a.createElement(p.a,{color:"light",light:!0,className:"fixed-top"},c.a.createElement("div",{className:"d-flex align-items-center mr-auto"},c.a.createElement(b.a,{type:"button",color:D?"secondary":"primary",className:"mr-3",onClick:function(){Me(!1),L.current.click()},id:"upload",ref:T},Object(G.t)("changeMidi")),Ne&&c.a.createElement(f.a,{target:"upload",isOpen:qe,delay:4e3,fade:!0},Object(G.t)("startHere")),c.a.createElement("input",{ref:L,type:"file",id:"midi-file-input",className:"d-none",accept:"audio/midi, audio/x-midi",onChange:function(e){var t=e.target.files[0],a=new FileReader;a.readAsArrayBuffer(t),a.onload=function(e){var t=e.target.result;if(t)if(t.tracks<1)window.alert(Object(G.t)("message.noTracks"));else{var a=new X.Midi(t),n=a.header.tempos.length?a.header.tempos.slice(-1)[0].bpm:120;R(a),W(0),Z(n),ge(a.tracks[K].notes.map((function(){return"\u3089"}))),me(24),document.querySelector("#sequence-key-72").scrollIntoView(),ie(!0),document.querySelector("#lyricEditInput").focus()}},a.onerror=function(e){window.alert(Object(G.t)("message.failedToLoadFile"))}}}),c.a.createElement("span",{className:"navbar-text mr-2"},Object(G.t)("track")),c.a.createElement(h.a,{type:"select",color:"light",size:"sm",onChange:function(e){W(e.target.value)},style:{width:"120px"},className:"mr-3",disabled:!D},D&&D.toJSON().tracks.map((function(e,t){return c.a.createElement("option",{key:t,value:t},t+1,": ",e.name)}))),c.a.createElement("span",{className:"navbar-text mr-2"},Object(G.t)("bpm")),c.a.createElement(h.a,{type:"number",color:"light",size:"sm",value:Y,onChange:function(e){Z(e.target.value)},style:{width:"70px"},className:"mr-3",disabled:!D}),c.a.createElement("span",{className:"navbar-text mr-2"},Object(G.t)("transpose")),c.a.createElement(h.a,{type:"number",min:"-24",max:"24",size:"sm",value:ae,style:{width:"70px"},onChange:function(e){ne(e.target.value)},disabled:!D})),c.a.createElement(b.a,{color:"primary",onClick:function(){var e=D.toJSON(),t=e.header,a=Array.isArray(t.timeSignatures)&&t.timeSignatures.length>0?t.timeSignatures[0].timeSignature:[4,4],n=e.tracks[K],c=n.notes.slice(-1)[0].durationTicks+n.notes.slice(-1)[0].ticks,r=t.ppq*a[1]*(a[0]/a[1]),l=Math.ceil(c/r),i=Object(u.a)(Array(l).keys()).map((function(e,t){var a=t*r,c=a+r,l=n.notes.map((function(e,t){return c>e.ticks&&(a<=e.ticks||a<e.ticks+e.durationTicks)?Object(o.a)(Object(o.a)({},e),{},{lyric:ye[t]||""}):null})).filter((function(e){return null!==e})),i=[];return 0===l.length?i.push({rest:{},duration:{_text:r}}):l.forEach((function(e,t,n){var r=n[t-1]||!1,l=n[t+1]||!1,s=e.ticks+e.durationTicks,o=!!r&&r.ticks+r.durationTicks;!r&&e.ticks>a?i.push({rest:{},duration:{_text:e.ticks-a}}):!r&&e.ticks<a?i.push({_attributes:{dynamics:100*e.velocity},pitch:z(e.midi,ae),duration:{_text:s-a},tie:{_attributes:{type:"stop"}}}):r&&o<e.ticks&&i.push({rest:{},duration:{_text:e.ticks-o}}),s>c?i.push({_attributes:{dynamics:100*e.velocity},pitch:z(e.midi,ae),duration:{_text:c-e.ticks},lyric:{text:{_text:e.lyric}},tie:{_attributes:{type:"start"}}}):e.ticks>=a&&i.push({_attributes:{dynamics:100*e.velocity},pitch:z(e.midi,ae),duration:{_text:e.durationTicks},lyric:{text:{_text:e.lyric}}}),!l&&c>s&&i.push({rest:{},duration:{_text:c-s}})})),{_attributes:{number:t+2},note:i}}));i.unshift({_attributes:{number:"1"},attributes:{divisions:{_text:t.ppq},key:{fifths:{_text:"0"}},time:{beats:{_text:a[0]},"beat-type":{_text:a[1]}},clef:{sign:{_text:"G"},line:{_text:"2"}}},direction:{_attributes:{placement:"above"},sound:{_attributes:{tempo:Y}}},note:{rest:{},duration:{_text:r}}});var s={_declaration:{_attributes:{version:"1.0",encoding:"utf-8"}},_doctype:'score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd"',"score-partwise":{_attributes:{version:"3.1"},"part-list":{"score-part":{_attributes:{id:"p".concat(K)},"part-name":{_text:t.name||""}}},part:{_attributes:{id:"p".concat(K)},measure:i}}},m=V.a.json2xml(s,{compact:!0,spaces:2}),d=new Blob([m],{type:"text/plain;charset=utf-8"}),p=document.createElement("a");p.download="score.musicxml",p.href=URL.createObjectURL(d),p.click()},className:"mr-1",disabled:!D},Object(G.t)("download")),c.a.createElement(E.a,null,c.a.createElement(y.a,{color:"light"},c.a.createElement(H.a,null)),c.a.createElement(g.a,null,c.a.createElement(v.a,{onClick:function(){return Be("en")}},Object(G.t)("english")),c.a.createElement(v.a,{onClick:function(){return Be("ja")}},Object(G.t)("japanese")),c.a.createElement(v.a,{divider:!0}),c.a.createElement(v.a,{onClick:function(){return Ie(!0)}},Object(G.t)("about"))))),c.a.createElement(k.a,{fluid:!0,className:"px-0",style:{marginTop:"56px"}},c.a.createElement(O.a,{className:"no-gutters",onClick:function(){return ie(!1)}},c.a.createElement(j.a,null,c.a.createElement(A,{midi:D,trackIndex:K,transpose:ae,lyric:ye,setLyric:ge,xScale:be,yScale:ue}))),c.a.createElement(O.a,null,c.a.createElement("div",{className:"sequence-controls"},c.a.createElement("div",{className:"d-flex align-items-start"},c.a.createElement("div",{className:"w-100 p-2"},c.a.createElement(x.a,{pills:!0,className:"mb-2"},c.a.createElement(w.a,null,c.a.createElement(N.a,{href:"#",onClick:function(){je("lyrics")},active:"lyrics"===Oe},Object(G.t)("lyrics"))),c.a.createElement(w.a,null,c.a.createElement(N.a,{href:"#",onClick:function(){je("velocity")},active:"velocity"===Oe,disabled:!0},Object(G.t)("velocity")))),c.a.createElement(_.a,{activeTab:Oe},c.a.createElement(S.a,{tabId:"lyrics"},c.a.createElement(F,{lyric:ye,setLyric:ge,expand:le,setExpand:ie,limit:D?D.tracks[K].notes.length:0,disabled:!D})))),c.a.createElement("div",{className:"px-3"},c.a.createElement(h.a,{type:"range",className:"sequence-scale-range",max:"0.5",min:"0.025",step:"0.025",value:be,onChange:function(e){fe(e.target.value)}})))))),c.a.createElement(J,{show:Ae,handleClose:function(){Ie(!1)}})):""},$=function(){return c.a.createElement(i.a,{basename:"/midi-musicxml-seq"},c.a.createElement(s.c,null,c.a.createElement(s.a,{exact:!0,path:"/",component:W}),c.a.createElement(s.a,{component:function(){return c.a.createElement("div",null,"404 Not found")}})))};var Q=function(){return c.a.createElement("div",{className:"app"},c.a.createElement("main",{className:"main"},c.a.createElement($,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(c.a.createElement(Q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},91:function(e,t,a){e.exports=a(157)},96:function(e,t,a){}},[[91,1,2]]]);
//# sourceMappingURL=main.ba895c91.chunk.js.map